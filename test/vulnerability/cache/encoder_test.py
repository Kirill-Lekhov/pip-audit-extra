from pip_audit_extra.vulnerability.cache.encoder import JSONEncoder
from test.factory import make_vulnerability_data

from datetime import datetime, timezone

import pytest


class TestJSONEncoder:
	def test_default(self):
		encoder = JSONEncoder()
		vuln_data = make_vulnerability_data("ID.1", ["FIX_VER.1", "FIX_VER.2"], "CRITICAL")

		assert encoder.default(vuln_data) == {
			"id": "ID.1",
			"fix_versions": ["FIX_VER.1", "FIX_VER.2"],
			"severity": "CRITICAL",
		}
		assert encoder.default(datetime(2024, 6, 12, 10, 11, 12, tzinfo=timezone.utc)) == "2024-06-12T10:11:12+00:00"

		with pytest.raises(TypeError):
			encoder.default("TEST")
